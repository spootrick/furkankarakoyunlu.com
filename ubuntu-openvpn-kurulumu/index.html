<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Nedir bu VPN?İnternete güvenli bir şekilde bağlanmak mı istiyorsunuz? Starbucks, avm yada otel WIFI’ını kullanarak güvenemeyeceğiniz ortak bir ağdan mı bağlanmak zorundasınız? Tamam, işte aradığınız">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenVPN Kurulumu (Ubuntu 16.04)">
<meta property="og:url" content="http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/index.html">
<meta property="og:site_name" content="Furkan Karakoyunlu">
<meta property="og:description" content="Nedir bu VPN?İnternete güvenli bir şekilde bağlanmak mı istiyorsunuz? Starbucks, avm yada otel WIFI’ını kullanarak güvenemeyeceğiniz ortak bir ağdan mı bağlanmak zorundasınız? Tamam, işte aradığınız">
<meta property="og:image" content="https://furkankarakoyunlu.com/images/ubuntu_openvpn_kurulum.jpg">
<meta property="og:updated_time" content="2017-02-23T17:09:12.860Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="OpenVPN Kurulumu (Ubuntu 16.04)">
<meta name="twitter:description" content="Nedir bu VPN?İnternete güvenli bir şekilde bağlanmak mı istiyorsunuz? Starbucks, avm yada otel WIFI’ını kullanarak güvenemeyeceğiniz ortak bir ağdan mı bağlanmak zorundasınız? Tamam, işte aradığınız">
<meta name="twitter:image" content="https://furkankarakoyunlu.com/images/ubuntu_openvpn_kurulum.jpg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>OpenVPN Kurulumu (Ubuntu 16.04)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/lib/meslo-LG/styles.css">
    <link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
    <!-- jquery -->
    <script src="/lib/jquery/jquery.min.js"></script>
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spootrick">Projects</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/ubuntu-server-setup/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover='$("#i-next").toggle();' onmouseout='$("#i-next").toggle();'></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover='$("#i-top").toggle();' onmouseout='$("#i-top").toggle();'></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover='$("#i-share").toggle();' onmouseout='$("#i-share").toggle();' onclick='$("#share").toggle();return false;'></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&text=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&is_video=false&description=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OpenVPN Kurulumu (Ubuntu 16.04)&body=Check out this article: http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&name=OpenVPN Kurulumu (Ubuntu 16.04)&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nedir-bu-VPN"><span class="toc-number">1.</span> <span class="toc-text">Nedir bu VPN?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gerekenler"><span class="toc-number">2.</span> <span class="toc-text">Gerekenler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Kurulumu"><span class="toc-number">3.</span> <span class="toc-text">OpenVPN Kurulumu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CA-Dizini"><span class="toc-number">4.</span> <span class="toc-text">CA Dizini</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CA-Degiskenlerinin-Ayarlanmasi"><span class="toc-number">5.</span> <span class="toc-text">CA Değişkenlerinin Ayarlanması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sertifika-Otoritesini-Olusturmak-CA"><span class="toc-number">6.</span> <span class="toc-text">Sertifika Otoritesini Oluşturmak (CA)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sunucu-Sertifikasi-Anahtar-ve-Sifreleme-Dosyalarini-Olusturmak"><span class="toc-number">7.</span> <span class="toc-text">Sunucu Sertifikası, Anahtar ve Şifreleme Dosyalarını Oluşturmak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma"><span class="toc-number">8.</span> <span class="toc-text">İstemci Sertifikası ve Anahtar Çifti Oluşturma</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Hizmetini-Yapilandirma"><span class="toc-number">9.</span> <span class="toc-text">OpenVPN Hizmetini Yapılandırma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dosyalari-OpenVPN-Dizinine-Kopyalama"><span class="toc-number">9.1.</span> <span class="toc-text">Dosyaları OpenVPN Dizinine Kopyalama</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenVPN-Ayarlarinin-Yapilmasi"><span class="toc-number">9.2.</span> <span class="toc-text">OpenVPN Ayarlarının Yapılması</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tum-Trafigin-Yonlendirilmesi"><span class="toc-number">9.3.</span> <span class="toc-text">Tüm Trafiğin Yönlendirilmesi</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sunucu-Ag-Yapilandirmasi"><span class="toc-number">10.</span> <span class="toc-text">Sunucu Ağ Yapılandırması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Firewall-Ayarlarinin-Yapilmasi"><span class="toc-number">11.</span> <span class="toc-text">Firewall Ayarlarının Yapılması</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Port-Ayarlarinin-Yapilmasi"><span class="toc-number">11.1.</span> <span class="toc-text">Port Ayarlarının Yapılması</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Servisinin-Baslatilmasi"><span class="toc-number">12.</span> <span class="toc-text">OpenVPN Servisinin Başlatılması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Yapilandirma-Altyapisi-Olusturma"><span class="toc-number">13.</span> <span class="toc-text">İstemci Yapılandırma Altyapısı Oluşturma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Temel-Ayarlari-Olusturmak"><span class="toc-number">13.1.</span> <span class="toc-text">Temel Ayarları Oluşturmak</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ayar-Dosyalarini-Olusturan-Script’i-Yazmak"><span class="toc-number">13.2.</span> <span class="toc-text">Ayar Dosyalarını Oluşturan Script’i Yazmak</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Ayarlarini-Olusturmak"><span class="toc-number">14.</span> <span class="toc-text">İstemci Ayarlarını Oluşturmak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yapilandirma-Dosyalarinin-Transferi"><span class="toc-number">15.</span> <span class="toc-text">Yapılandırma Dosyalarının Transferi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Yapilandirmasini-Yuklemek"><span class="toc-number">16.</span> <span class="toc-text">İstemci Yapılandırmasını Yüklemek</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">16.1.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSX"><span class="toc-number">16.2.</span> <span class="toc-text">OSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">16.3.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android"><span class="toc-number">16.4.</span> <span class="toc-text">Android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iOS"><span class="toc-number">16.5.</span> <span class="toc-text">iOS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-Baglanti-Testi"><span class="toc-number">17.</span> <span class="toc-text">VPN Bağlantı Testi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Sertifikalarini-Iptal-Etmek"><span class="toc-number">18.</span> <span class="toc-text">İstemci Sertifikalarını İptal Etmek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yeni-Istemci-Ekleme"><span class="toc-number">19.</span> <span class="toc-text">Yeni İstemci Ekleme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sonuc"><span class="toc-number">20.</span> <span class="toc-text">Sonuç</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        OpenVPN Kurulumu (Ubuntu 16.04)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Furkan Karakoyunlu</span>
      </span>
      
    <div class="postdate">
        <time datetime="2017-02-23T17:09:12.860Z" itemprop="datePublished">23 Feb 2017</time>
    </div>


      
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/OpenVPN/">OpenVPN</a>, <a class="tag-link" href="/tags/OpenVPN-Android/">OpenVPN Android</a>, <a class="tag-link" href="/tags/OpenVPN-Linux/">OpenVPN Linux</a>, <a class="tag-link" href="/tags/OpenVPN-Mac-OS-X/">OpenVPN Mac OS X</a>, <a class="tag-link" href="/tags/OpenVPN-Windows/">OpenVPN Windows</a>, <a class="tag-link" href="/tags/OpenVPN-iOS/">OpenVPN iOS</a>, <a class="tag-link" href="/tags/Ubuntu/">Ubuntu</a>, <a class="tag-link" href="/tags/Ubuntu-16-04/">Ubuntu 16.04</a>, <a class="tag-link" href="/tags/Ubuntu-OpenVPN/">Ubuntu OpenVPN</a>, <a class="tag-link" href="/tags/VPN/">VPN</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://furkankarakoyunlu.com/images/ubuntu_openvpn_kurulum.jpg" alt="OpenVPN Server Setup Ubuntu 16.04"></p>
<h2 id="Nedir-bu-VPN"><a href="#Nedir-bu-VPN" class="headerlink" title="Nedir bu VPN?"></a>Nedir bu VPN?</h2><p>İnternete güvenli bir şekilde bağlanmak mı istiyorsunuz? Starbucks, avm yada otel WIFI’ını kullanarak güvenemeyeceğiniz ortak bir ağdan mı bağlanmak zorundasınız? Tamam, işte aradığınız şey VPN! (Kime anlatıyorum ya, güzel ülkemizde sürekli internet yasakları yüzünden el kadar çocuklar bile VPN kullanır oldu. Sevinsek mi üzülsek mi bilmiyorum.)</p>
<p>Bu yazımda ticari amaçlarla piyasaya sürülen VPN servisleri yerine aylık 5 dolar gibi cüzzi bir miktar ile kendinize ait bir VPN sunucusu kurmayı anlatmaya çalışacağım.</p>
<p>Şimdi biraz daha teknik konulara girelim. VPN, yani Virtual Private Network adından da anlaşılacağı üzere sanal özel bir ağdır. Bu ağ aracılığı ile başka bir ağa fiziksel olarak bağlıymışsınız gibi o ağ üzerinden veri alışverişlerinde bulunabilirsiniz. Az laf çok iş hadi başlayalım.</p>
<h2 id="Gerekenler"><a href="#Gerekenler" class="headerlink" title="Gerekenler"></a>Gerekenler</h2><p>Bu yazıyı takip edebilmeniz için size gerekenler;</p>
<ul>
<li>Ubuntu 16.04 Sunucu</li>
<li>non-root <code>sudo</code> kullanıcı</li>
<li>Firewall</li>
</ul>
<p>Eğer bu terimler size tanıdık gelmiyorsa <a href="https://furkankarakoyunlu.com/ubuntu-server-setup/">Ubuntu 16.04 Server Setup</a> yazımı okuyup kendinize yeni bir sunucu hazırlayabilirsiniz. Herşey tamam ama sunucuyu nereden bulacağız diyorsanız ben <a href="https://m.do.co/c/56e2f8751615" target="_blank" rel="external">DigitalOcean</a> servislerini kullanıyorum. Saatlik 0.007 dolar (aylık 5 dolara geliyor) harcayarak 512MB RAM, 1.8 GHz CPU, 20GB SSD ve aylık 1TB trafik hakkı olan bir sunucu kiralayabiliyorsunuz. DigitalOcean kullanımını başka bir yazımda ele alacağım. Bence gayet uygun. Eğer isterseniz başka servisler de var tabii; amazon aws, rackspace, vultr, … Seçim size kalmış.</p>
<h2 id="OpenVPN-Kurulumu"><a href="#OpenVPN-Kurulumu" class="headerlink" title="OpenVPN Kurulumu"></a>OpenVPN Kurulumu</h2><p>Ubuntu’nun varsayılan repository’lerinde OpenVPN halihazırda bulunmakta. Kurmak için <code>apt</code> kullanabilirsiniz. OpenVPN’e ek olarak <code>easy-rsa</code> pakedini de yükleyelim ki VPN’imiz için dahili CA (certificate authority) kurmamızda yardımcı olsun.</p>
<p>Önce sunucumuzdaki paket dizinini güncelleyelim<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update &amp;&amp; sudo apt-get -y upgrade</div></pre></td></tr></table></figure></p>
<p>şimdi gerekli paketleri yükleyebiliriz<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install openvpn easy-rsa</div></pre></td></tr></table></figure></p>
<h2 id="CA-Dizini"><a href="#CA-Dizini" class="headerlink" title="CA Dizini"></a>CA Dizini</h2><p>OpenVPN, anahtar değişimi için SSL/TLS kullanan özel bir güvenlik protokolüne sahiptir. Yani sunucu ve istemciler arasındaki trafiği şifrelemek için sertifikalar kullanır. Bu güvenlik sertifikalarını çıkartabilmek için kendi CA’mızı kurmamız gerekecek.</p>
<p>Öncelikle sertifikalarımız için ev dizinimizin içine <code>easy-rsa</code> şablonunu kullanarak bir sertifika dizini oluşturalım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ make-cadir ~/openvpn-CA</div></pre></td></tr></table></figure></p>
<h2 id="CA-Degiskenlerinin-Ayarlanmasi"><a href="#CA-Degiskenlerinin-Ayarlanmasi" class="headerlink" title="CA Değişkenlerinin Ayarlanması"></a>CA Değişkenlerinin Ayarlanması</h2><p>Az önce oluşturduğumuz dizinin içine girelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cd ~/openvpn-CA</div></pre></td></tr></table></figure></p>
<p>CA’mızın kullanacağı değerleri ayarlamak için <code>vars</code> dosyasını düzenlememiz gerekecek. Bu dosyayı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi vars</div></pre></td></tr></table></figure></p>
<p>Burada sertifikalarımızın nasıl oluşturulacağı ile ilgili bazı değişkenler bulunuyor. Bizim işimize yarayacak olan kısım dosyanın sonuna doğru bakacak olursak şu kısım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"># These are the default values for fields</div><div class="line"># which will be placed in the certificate.</div><div class="line"># Don&apos;t leave any of these fields blank.</div><div class="line">export KEY_COUNTRY=&quot;US&quot;</div><div class="line">export KEY_PROVINCE=&quot;CA&quot;</div><div class="line">export KEY_CITY=&quot;SanFrancisco&quot;</div><div class="line">export KEY_ORG=&quot;Fort-Funston&quot;</div><div class="line">export KEY_EMAIL=&quot;me@myhost.mydomain&quot;</div><div class="line">export KEY_OU=&quot;MyOrganizationalUnit&quot;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Bu değerleri uygun şekilde değiştirelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">export KEY_COUNTRY=&quot;NL&quot;</div><div class="line">export KEY_PROVINCE=&quot;AMS&quot;</div><div class="line">export KEY_CITY=&quot;Amsterdam&quot;</div><div class="line">export KEY_ORG=&quot;Lahmacun LTD STI&quot;</div><div class="line">export KEY_EMAIL=&quot;furkankarakoyunlu@gmail.com&quot;</div><div class="line">export KEY_OU=&quot;N/A&quot;</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Buraya yazdığımız bilgiler sertifikamızda kullanılacak. Bunlara ek olarak <code>KEY_NAME</code> kısmını da değiştirmemiz lazım. Ben <code>kebap</code> olarak değiştireceğim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">export KEY_NAME=&quot;kebap&quot;</div></pre></td></tr></table></figure></p>
<p>Gereken yerleri değiştirdikten sonra dosyayı kaydedip çıkabilirsiniz.</p>
<h2 id="Sertifika-Otoritesini-Olusturmak-CA"><a href="#Sertifika-Otoritesini-Olusturmak-CA" class="headerlink" title="Sertifika Otoritesini Oluşturmak (CA)"></a>Sertifika Otoritesini Oluşturmak (CA)</h2><p>Bu adımda az önce ayarladığımız <code>vars</code> dosyasını <code>easy-rsa</code> ile kullanarak CA’mızı oluşturmak için kullanacağız.</p>
<p>Oluşturduğumuz <code>openvpn-CA</code> klasörünün içindeyken aşağıdaki komutları girelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ source vars</div></pre></td></tr></table></figure></p>
<p>Bu komut şu şekilde bir çıktı verecektir:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/spootrick/openvpn-CA/keys</div></pre></td></tr></table></figure></p>
<p>Temiz bir ortamda çalıştığımızdan emin olmak için şunu yazalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./clean-all</div></pre></td></tr></table></figure></p>
<p>Şimdi aşağıdaki komutu yazarak kök CA (root CA)’mızı oluşturabiliriz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./build-ca</div></pre></td></tr></table></figure></p>
<p>Bu komut, kök CA (root CA) için sertifika ve anahtar oluşturma işlemini başlatacak. Komut ekranında size aşağıdaki gibi bazı seçimler soracak. Biz daha önceden <code>vars</code> dosyasında bu değişiklikleri yaptığımız için seçimleri <code>ENTER</code> tuşuyla onaylayıp geçebilirsiniz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">Generating a 2048 bit RSA private key</div><div class="line">..............................................+++</div><div class="line">....................................................................................................................................................................................................+++</div><div class="line">writing new private key to &apos;ca.key&apos;</div><div class="line">-----</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter &apos;.&apos;, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [NL]:</div><div class="line">State or Province Name (full name) [AMS]:</div><div class="line">Locality Name (eg, city) [Amsterdam]:</div><div class="line">Organization Name (eg, company) [Lahmacun LTD STI]:</div><div class="line">Organizational Unit Name (eg, section) [N/A]:</div><div class="line">Common Name (eg, your name or your server&apos;s hostname) [Lahmacun LTD STI CA]:</div><div class="line">Name [kebap]:</div><div class="line">Email Address [furkankarakoyunlu@gmail.com]:</div></pre></td></tr></table></figure></p>
<p>Bu aşamadan sonra gerekli diğer dosyaları oluşturmak için kullanacağımız CA’mızı oluşturmuş olduk.</p>
<h2 id="Sunucu-Sertifikasi-Anahtar-ve-Sifreleme-Dosyalarini-Olusturmak"><a href="#Sunucu-Sertifikasi-Anahtar-ve-Sifreleme-Dosyalarini-Olusturmak" class="headerlink" title="Sunucu Sertifikası, Anahtar ve Şifreleme Dosyalarını Oluşturmak"></a>Sunucu Sertifikası, Anahtar ve Şifreleme Dosyalarını Oluşturmak</h2><p>Bu adımda sunucu sertifikamızı, anahtar çiftlerimizi ve şifreleme işlemi sırasında kullanılacak diğer dosyaları oluşturacağız.</p>
<p>OpenVPN sunucu sertifikası ve anahtar çiftimizi oluşturmakla başlayalım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./build-key-server kebap</div></pre></td></tr></table></figure></p>
<p>Not: Eğer buradakinden farklı bir sunucu ismi seçtiyseniz bazı kısımları ayarlamanız gerekecek. Örneğin, oluşturduğumuz dosyaları <code>/etc/openvpn</code> dizinine kopyalarken koyduğunuz ismi ayarlamanız gerekecek. Aynı zamanda <code>/etc/openvpn/kebap.conf</code> dosyasını da geçerli <code>.crt</code> ve <code>.key</code> dosyalarına hedef göstermeniz gerekecek.</p>
<p>Bu komutla birlikte bir sefer daha oluşturduğumuz sunucumuza göre (kebap) seçimlerimizi soracak. Varsayılan değerleri değiştirmeden <code>ENTER</code> tuşu ile geçebilirsiniz. Herhangi bir <code>challenge password</code> değeri girmeyin. Son olarak iki soruyu da <code>y</code> ile işaretleyerek sertifikamızı imzalayıp tamamlıyoruz. Çıktı şu şekilde olacak:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Generating a 2048 bit RSA private key</div><div class="line">.....................+++</div><div class="line">..........................................................................................+++</div><div class="line">writing new private key to &apos;server.key&apos;</div><div class="line">-----</div><div class="line">You are about to be asked to enter information that will be incorporated</div><div class="line">into your certificate request.</div><div class="line">What you are about to enter is what is called a Distinguished Name or a DN.</div><div class="line">There are quite a few fields but you can leave some blank</div><div class="line">For some fields there will be a default value,</div><div class="line">If you enter &apos;.&apos;, the field will be left blank.</div><div class="line">-----</div><div class="line">Country Name (2 letter code) [NL]:</div><div class="line">State or Province Name (full name) [AMS]:</div><div class="line">Locality Name (eg, city) [Amsterdam]:</div><div class="line">Organization Name (eg, company) [Lahmacun LTD STI]:</div><div class="line">Organizational Unit Name (eg, section) [N/A]:</div><div class="line">Common Name (eg, your name or your server&apos;s hostname) [kebap]:</div><div class="line">Name [kebap]:</div><div class="line">Email Address [furkankarakoyunlu@gmail.com]:</div><div class="line"></div><div class="line">Please enter the following &apos;extra&apos; attributes</div><div class="line">to be sent with your certificate request</div><div class="line">A challenge password []:</div><div class="line">An optional company name []:</div><div class="line">Using configuration from /home/spootrick/openvpn-CA/openssl-1.0.0.cnf</div><div class="line">Check that the request matches the signature</div><div class="line">Signature ok</div><div class="line">The Subject&apos;s Distinguished Name is as follows</div><div class="line">countryName           :PRINTABLE:&apos;NL&apos;</div><div class="line">stateOrProvinceName   :PRINTABLE:&apos;AMS&apos;</div><div class="line">localityName          :PRINTABLE:&apos;Amsterdam&apos;</div><div class="line">organizationName      :PRINTABLE:&apos;Lahmacun LTD STI&apos;</div><div class="line">organizationalUnitName:PRINTABLE:&apos;N/A&apos;</div><div class="line">commonName            :PRINTABLE:&apos;kebap&apos;</div><div class="line">name                  :PRINTABLE:&apos;kebap&apos;</div><div class="line">emailAddress          :IA5STRING:&apos;furkankarakoyunlu@gmail.com&apos;</div><div class="line">Certificate is to be certified until Feb  3 15:28:52 2027 GMT (3650 days)</div><div class="line">Sign the certificate? [y/n]:y</div><div class="line"></div><div class="line"></div><div class="line">1 out of 1 certificate requests certified, commit? [y/n]y</div><div class="line">Write out database with 1 new entries</div><div class="line">Data Base Updated</div></pre></td></tr></table></figure></p>
<p>Ardından, anahtar değişimi sırasında kullanmak üzere güçlü bir Diffie-Hellman anahtarları oluşturacağız. Şu şekilde:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./build-dh</div></pre></td></tr></table></figure></p>
<p>Bu işlemin tamamlanması kullandığınız sunucunun gücüne bağlı olarak biraz zaman alabilir.</p>
<p>Sonrasında sunucumuzun TLS bütünlük doğrulama kapasitesini güçlendirmek için HMAC (Hash-based message authentication code) imzası üreteceğiz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ openvpn --genkey --secret keys/ta.key</div></pre></td></tr></table></figure></p>
<h2 id="Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma"><a href="#Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma" class="headerlink" title="İstemci Sertifikası ve Anahtar Çifti Oluşturma"></a>İstemci Sertifikası ve Anahtar Çifti Oluşturma</h2><p>Şimdi sırada istemci serfitikası ve anahtar çifti oluşturma işlemleri var. Bu işlemleri istemci makinada yapıp daha sonra güvenlik amacıyla sunucu üzerinde imzalayabiliriz. Fakat anlatımın karışmaması için sunucu üzerinde oluşturup devam edeceğim.</p>
<p>Bu adımda bir tane istemci için anahtar/sertifika oluşturacağım. Eğer birden fazla istemcinin VPN sunucumuza bağlanmasını istiyorsanız bu adımları istediğiniz kadar tekrar edebilirsiniz. Her istemci için farklı bir değer kullanmayı unutma!</p>
<p>İlk istemcimizin adı <code>spootrickLaptop</code> olsun.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cd ~/openvpn-CA</div><div class="line">$ source vars</div><div class="line">$ ./build-key spootrickLaptop</div></pre></td></tr></table></figure></p>
<p>build komutunu bu şekilde kullandığımızda bağlantılar için şifre istemeyecek ve istemcimiz otomatik olarak VPN servisimize bağlanacaktır.</p>
<p>Eğer şifreli bağlantılar oluşturmak istersek komutları şu şekilde girmemiz gerekir:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ cd ~/openvpn-CA</div><div class="line">$ source vars</div><div class="line">$ ./build-key-pass spootrickLaptop</div></pre></td></tr></table></figure></p>
<p>yine karşımıza gelen varsayılan değerleri değiştirmeden hepsini <code>ENTER</code> ile geçebiliriz. Challenge password değerini boş bırakın! Son iki soruyu da <code>y</code> ile işaretleyerek sertifikamızı imzalayıp tamamlamış olduk.</p>
<h2 id="OpenVPN-Hizmetini-Yapilandirma"><a href="#OpenVPN-Hizmetini-Yapilandirma" class="headerlink" title="OpenVPN Hizmetini Yapılandırma"></a>OpenVPN Hizmetini Yapılandırma</h2><p>Oluşturduğumuz kimlik bilgilerini ve dosyaları kullanrak OpenVPN hizmetimizi yapılandırmaya başlayabiliriz.</p>
<h3 id="Dosyalari-OpenVPN-Dizinine-Kopyalama"><a href="#Dosyalari-OpenVPN-Dizinine-Kopyalama" class="headerlink" title="Dosyaları OpenVPN Dizinine Kopyalama"></a>Dosyaları OpenVPN Dizinine Kopyalama</h3><p>Bu adımda ihtiyacımız olan dosyaları <code>/etc/openvpn</code> yapılandırma dizinine kopyalayacağız.</p>
<p>Bundan önceki adımlarda oluşturmuş olduğumuz dosyaları kopyalamamız gerekiyor. Bu dosyalar <code>~/openvpn-CA/keys</code> dizininde. Kopyalamamız gereken dosyalar şunlar:</p>
<ul>
<li><code>ca.crt</code>      (CA sertifikası)</li>
<li><code>ca.key</code>      (CA anahtarı)</li>
<li><code>kebap.crt</code>   (sunucumuzun sertifikası)</li>
<li><code>kebap.key</code>   (sunucumuzun anahtarı)</li>
<li><code>ta.key</code>      (HMAC imzası)</li>
<li><code>dh2048.pem</code>  (Diffie-Hellman dosyamız)</li>
</ul>
<p>Bunun için şu komutu girelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo cp ~/openvpn-CA/keys/&#123;ca.crt,ca.key,kebap.crt,kebap.key,ta.key,dh2048.pem&#125; /etc/openvpn</div></pre></td></tr></table></figure></p>
<p>Dosyaların kopyalandığını şu komutla kontrol edebilirsiniz:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls /etc/openvpn</div></pre></td></tr></table></figure></p>
<p>Kopyaladığınız dosyaları göreceksiniz.</p>
<p>Şimdi OpenVPN örnek ayar dosyasını zipten çıkarıp ayar yapacağımız dizine kopyalayalım. Bu şekilde kurulumumuzda temel olarak bu dosyayı kullanmış olacağız.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | sudo tee /etc/openvpn/kebap.conf</div></pre></td></tr></table></figure></p>
<p>Dosyamızın kopyalandığını doğrulayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls /etc/openvpn | grep kebap.conf</div></pre></td></tr></table></figure></p>
<p>dosyayı görüyorsanız işlem tamam.</p>
<h3 id="OpenVPN-Ayarlarinin-Yapilmasi"><a href="#OpenVPN-Ayarlarinin-Yapilmasi" class="headerlink" title="OpenVPN Ayarlarının Yapılması"></a>OpenVPN Ayarlarının Yapılması</h3><p>Kopyaladığımız dosyaları düzenleyelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/openvpn/kebap.conf</div></pre></td></tr></table></figure></p>
<p>İlk olarak HMAC ayarlarını bulalım. Bunun için <code>tls-auth</code> kısmına bakın. Aşağıdaki satırı bulun<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">;tls-auth ta.key 0 # This file is secret</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Satır başındaki <code>;</code> işaretini silin ve hemen altına <code>key-direction 0</code> satırını ekleyin. Şu şekilde gözükecek:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">tls-auth ta.key 0 # This file is secret</div><div class="line">key-direction 0</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Sonra cryptographic cipher bölümünden <code>AES-128-CBC</code> kısmını aktfileştirelim. <code>AES-128-CBC</code> ileri düzey bir şifreleme sunuyor. Bunun için satır başındaki <code>;</code> işaretini kaldırmamız lazım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">;cipher BF-CBC        # Blowfish (default)</div><div class="line">cipher AES-128-CBC   # AES</div><div class="line">;cipher DES-EDE3-CBC  # Triple-DES</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Bu kısmın hemen altına HMAC özeti algoritması seçmek için <code>auth</code> yetkilendirme satırını ekleyelim. Bunun için <code>SHA256</code> iyi bir seçim olacaktır.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">auth SHA256</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Şimdi <code>user</code> ve <code>group</code> bölümünü bulup başlarındaki <code>;</code> işaretlerini kaldıralım. Bu OpenVPN daemon (arkaplan işlemi) nin yetkilerini kısıtlar<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">user nobody</div><div class="line">group nogroup</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Son olarak sunucumuzun sertifikalarını belirtelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line">ca ca.crt</div><div class="line">cert kebap.crt</div><div class="line">key kebap.key  # This file should be kept secret</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Bütün değişiklikleri tamamladıktan sonra dosyamızı kaydedip kapatabiliriz.</p>
<h3 id="Tum-Trafigin-Yonlendirilmesi"><a href="#Tum-Trafigin-Yonlendirilmesi" class="headerlink" title="Tüm Trafiğin Yönlendirilmesi"></a>Tüm Trafiğin Yönlendirilmesi</h3><p>Şu ana kadar yaptığımız bütün ayarlar kullandığımız cihaz ve VPN sunucumuz arasındaki bağlantıyı sağlamak içindi. Bu yazıdaki amacımız trafiğimizi VPN sunucumuza yönlendirmek olduğu için <code>/etc/openvpn/kebap.conf</code> dosyamızda bir kaç ayar daha yapmamız gerekiyor.</p>
<p>Tüm trafiğimizi VPN’e yönlendirmek için DNS ayarlarını istemci bilgisayarımıza iletmemiz gerekiyor.</p>
<p>Bunun için <code>kebap.conf</code> dosyasında bazı satırların yorum sembolünü kaldırarak yapabiliriz.</p>
<p>Öncelikle dosyamızı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/openvpn/kebap.conf</div></pre></td></tr></table></figure></p>
<p>Dosyada <code>redirect-gateway</code> adlı kısmı bulalım ve <code>push &quot;redirect-gateway def1 bypass-dhcp&quot;</code> satırının başındaki <code>;</code> işaretini silelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"># If enabled, this directive will configure</div><div class="line"># all clients to redirect their default</div><div class="line"># network gateway through the VPN, causing</div><div class="line"># all IP traffic such as web browsing and</div><div class="line"># and DNS lookups to go through the VPN</div><div class="line"># (The OpenVPN server machine may need to NAT</div><div class="line"># or bridge the TUN/TAP interface to the internet</div><div class="line"># in order for this to work properly).</div><div class="line"></div><div class="line">push &quot;redirect-gateway def1 bypass-dhcp&quot;</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Hemen altındaki <code>dhcp-option</code> kısmındaki 2 satırın da yorum işaretlerini silelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"></div><div class="line"># Certain Windows-specific network settings</div><div class="line"># can be pushed to clients, such as DNS</div><div class="line"># or WINS server addresses.  CAVEAT:</div><div class="line"># http://openvpn.net/faq.html#dhcpcaveats</div><div class="line"># The addresses below refer to the public</div><div class="line"># DNS servers provided by opendns.com.</div><div class="line"></div><div class="line">push &quot;dhcp-option DNS 208.67.222.222&quot;</div><div class="line">push &quot;dhcp-option DNS 208.67.220.220&quot;</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Bu ayarlamalar istemci bilgisayarda VPN servisimizi varsayılan ağ geçidi olarak kullanmak için DNS ayarlarını yeniden yapılandırmada yardımcı olacaktır.</p>
<h2 id="Sunucu-Ag-Yapilandirmasi"><a href="#Sunucu-Ag-Yapilandirmasi" class="headerlink" title="Sunucu Ağ Yapılandırması"></a>Sunucu Ağ Yapılandırması</h2><p>OpenVPN’in trafiği doğru bir şekilde yönlendirmesi için birkaç ayar yapmamız lazım.</p>
<p>Bunun için <code>/etc/sysctl.conf</code> dosyamızı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/sysctl.conf</div></pre></td></tr></table></figure></p>
<p>Dosyanın içinde <code>net.ipv4.ip_forward</code> kısmını bulup başındaki <code>#</code> işaretini kaldıralım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"># Uncomment the next line to enable packet forwarding for IPv4</div><div class="line">net.ipv4.ip_forward=1</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Dosyamızı kaydedip kapatalım.</p>
<p>Ardından değişikliklerin geçerli olması için şunu yazın:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo sysctl -p</div></pre></td></tr></table></figure></p>
<h2 id="Firewall-Ayarlarinin-Yapilmasi"><a href="#Firewall-Ayarlarinin-Yapilmasi" class="headerlink" title="Firewall Ayarlarının Yapılması"></a>Firewall Ayarlarının Yapılması</h2><p>Eğer sunucunuzda bir firewall aktifse -ki umuyorum aktiftir :)- VPN servisimiz için ayarlamamız gerekiyor. Bunun için <code>/etc/ufw/before.rules</code> dosyasında değişiklikler yapacağız. Dosyamızı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/ufw/before.rules</div></pre></td></tr></table></figure></p>
<p>Bu dosya ufw kuralları yüklenmeden önce uygulanması gereken yapılandırma ayarlarını içerir.</p>
<p>Dosyanın içine gerekli satırları ekleyelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">#</div><div class="line"># rules.before</div><div class="line">#</div><div class="line"># Rules that should be run before the ufw command line added rules. Custom</div><div class="line"># rules should be added to one of these chains:</div><div class="line">#   ufw-before-input</div><div class="line">#   ufw-before-output</div><div class="line">#   ufw-before-forward</div><div class="line">#</div><div class="line"></div><div class="line"># START OPENVPN RULES</div><div class="line"># NAT table rules</div><div class="line">*nat</div><div class="line">:POSTROUTING ACCEPT [0:0]</div><div class="line"># Allow traffic from OpenVPN client to eth0</div><div class="line">-A POSTROUTING -s 10.8.0.0/8 -o eth0 -j MASQUERADE</div><div class="line">COMMIT</div><div class="line"># END OPENVPN RULES</div><div class="line"></div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Dosyaya <code># START OPENVPN RULES</code> ve <code># END OPENVPN RULES</code> tag ları arasındaki kısımları ekledikten sonra kaydedip kapatalım.</p>
<p>Buna ek olarak UFW’ye varsayılan olarak iletilen paketlere izin vermesini söylemeliyiz. Bunun için ayar dosyamızı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/default/ufw</div></pre></td></tr></table></figure></p>
<p>Dosyanın içinde <code>DEFAULT_FORWARD_POLICY</code> satırını bulup değerini <code>ACCEPT</code> olarak değiştirelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">DEFAULT_FORWARD_POLICY=&quot;ACCEPT&quot;</div></pre></td></tr></table></figure></p>
<p>Değişikliğimizi yaptıktan sonra dosyayı kaydedip kapatalım.</p>
<h3 id="Port-Ayarlarinin-Yapilmasi"><a href="#Port-Ayarlarinin-Yapilmasi" class="headerlink" title="Port Ayarlarının Yapılması"></a>Port Ayarlarının Yapılması</h3><p>Şimdi firewall ımızda portlarımızı açalım ve aktifleştirelim. OpenVPN varsayılan olarak <code>1194</code> portunu kullanıyor. <code>1194</code> portunu <code>UDP</code> trafiğine açalım. Öncesinde ufw durumunu kontrol edelim:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo ufw status</div></pre></td></tr></table></figure></p>
<p>şimdi portumuzu açalım<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo ufw allow 1194/udp</div></pre></td></tr></table></figure></p>
<p>Bu işlemlerden sonra sunucumuz OpenVPN trafiğini düzgün bir şekilde işleyebilecektir.</p>
<h2 id="OpenVPN-Servisinin-Baslatilmasi"><a href="#OpenVPN-Servisinin-Baslatilmasi" class="headerlink" title="OpenVPN Servisinin Başlatılması"></a>OpenVPN Servisinin Başlatılması</h2><p>OpenVPN servisimizi çalıştırmak için <code>systemd</code> kullanabiliriz.</p>
<p>Sunucumuzun konfigurasyon dosyası adı ile birlikte çalıştırmamız gerekiyor. Sunucumuzun konfigurasyon dosyası <code>/etc/openvpn/kebap.conf</code> bu yüzden komutun sonuna <code>@kebap</code> ekleyeceğiz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl start openvpn@kebap</div></pre></td></tr></table></figure></p>
<p>servisimizin başarılı bir şekilde çalıştığını doğrulayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl status openvpn@kebap</div></pre></td></tr></table></figure></p>
<p>Her şey doğru gittiyse şu şekilde bir çıktı alacaksınız:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">● openvpn@kebap.service - OpenVPN connection to kebap</div><div class="line">   Loaded: loaded (/lib/systemd/system/openvpn@.service; disabled; vendor preset: enabled)</div><div class="line">   Active: active (running) since Tue 2017-02-21 14:09:01 UTC; 6s ago</div><div class="line">     Docs: man:openvpn(8)</div><div class="line">           https://community.openvpn.net/openvpn/wiki/Openvpn23ManPage</div><div class="line">           https://community.openvpn.net/openvpn/wiki/HOWTO</div><div class="line">  Process: 27686 ExecStart=/usr/sbin/openvpn --daemon ovpn-%i --status /run/openvpn/%i.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/%i.conf -</div><div class="line"> Main PID: 27690 (openvpn)</div><div class="line">   CGroup: /system.slice/system-openvpn.slice/openvpn@kebap.service</div><div class="line">           └─27690 /usr/sbin/openvpn --daemon ovpn-kebap --status /run/openvpn/kebap.status 10 --cd /etc/openvpn --script-security 2 --config /etc/openvpn/kebap.co</div><div class="line"></div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: /sbin/ip addr add dev tun0 local 10.8.0.1 peer 10.8.0.2</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: /sbin/ip route add 10.8.0.0/24 via 10.8.0.2</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: GID set to nogroup</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: UID set to nobody</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: UDPv4 link local (bound): [undef]</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: UDPv4 link remote: [undef]</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: MULTI: multi_init called, r=256 v=256</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: IFCONFIG POOL: base=10.8.0.4 size=62, ipv6=0</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: IFCONFIG POOL LIST</div><div class="line">Feb 21 14:09:01 sandbox ovpn-kebap[27690]: Initialization Sequence Completed</div></pre></td></tr></table></figure></p>
<p>Bu da tamamsa servisimizi etkinleştirelim ki sunucumuz yeniden başlatılırsa otomatik olarak boot aşamasında çalışsın:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl enable openvpn@kebap</div></pre></td></tr></table></figure></p>
<p>Artık sunucumuzdaki OpenVPN servisi aktif ve çalışıyor durumda. Sırada bu servise bağlanacak kullanıcılar için olan ayarlamaları yapacağız.</p>
<h2 id="Istemci-Yapilandirma-Altyapisi-Olusturma"><a href="#Istemci-Yapilandirma-Altyapisi-Olusturma" class="headerlink" title="İstemci Yapılandırma Altyapısı Oluşturma"></a>İstemci Yapılandırma Altyapısı Oluşturma</h2><p>Sıradaki işimiz kullanıcılarımız için ayar dosyalarını oluşturmak. Bunun için <code>home</code> klasörümüze <code>client-configs</code> ve bunun içine <code>files</code> dosyalarını oluşturalım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ mkdir -p ~/client-configs/files</div></pre></td></tr></table></figure></p>
<p><code>files</code> klasörümüzde sunucularımıza bağlanacak olan istemcilerin anahtarları bulunacağı için güvenlik amacıyla klasöre erişimi kısıtlayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ chmod 700 ~/client-configs/files</div></pre></td></tr></table></figure></p>
<h3 id="Temel-Ayarlari-Olusturmak"><a href="#Temel-Ayarlari-Olusturmak" class="headerlink" title="Temel Ayarları Oluşturmak"></a>Temel Ayarları Oluşturmak</h3><p>Temel ayarlarımız için openvpn örnek ayar dosyasını <code>base.conf</code> adıyla kopyalayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf</div></pre></td></tr></table></figure></p>
<p>Kopyaladığımız dosyayı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi ~/client-configs/base.conf</div></pre></td></tr></table></figure></p>
<p>Burada <code>remote</code> bölümünü bulup sunucumuzun IP adresini girelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"># The hostname/IP and port of the server.</div><div class="line"># You can have multiple remote entries</div><div class="line"># to load balance between the servers.</div><div class="line">remote buraya_IP_adresi_gelecek 1194</div><div class="line">...</div></pre></td></tr></table></figure></p>
<p>Yine aynı dosya içinde <code>proto</code> bölümünden protokolün <code>udp</code> olduğunu kontrol edelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># Are we connecting to a TCP or</div><div class="line"># UDP server?  Use the same setting as</div><div class="line"># on the server.</div><div class="line">proto udp</div></pre></td></tr></table></figure></p>
<p><code>user</code> ve <code>group</code> kısmını bulup baştaki <code>;</code> işaretini kaldıralım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># Downgrade privileges after initialization (non-Windows only)</div><div class="line">user nobody</div><div class="line">group nogroup</div></pre></td></tr></table></figure></p>
<p>Sonrasında yine aynı dosya içinde sertifikaların olduğu bölümü bulup satıları yorum haline getirelim. Sertifikalarımızın içine bu anahtarları ekleyeceğiz burada tanımlamamıza gerek yok.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"># SSL/TLS parms.</div><div class="line"># See the server config file for more</div><div class="line"># description.  It&apos;s best to use</div><div class="line"># a separate .crt/.key file pair</div><div class="line"># for each client.  A single ca</div><div class="line"># file can be used for all clients.</div><div class="line"># ca ca.crt</div><div class="line"># cert client.crt</div><div class="line"># key client.key</div></pre></td></tr></table></figure></p>
<p>Daha sonra ise dosyamızın en altına, <code>/etc/openvpn/kebap.conf</code> dosyasında yaptığımız şifreleme ayarlarını kopyalayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cipher AES-128-CBC</div><div class="line">auth SHA256</div></pre></td></tr></table></figure></p>
<p>Bunun altına <code>key-direction</code> satırını ekleyelim.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">key-direction 1</div></pre></td></tr></table></figure></p>
<h3 id="Ayar-Dosyalarini-Olusturan-Script’i-Yazmak"><a href="#Ayar-Dosyalarini-Olusturan-Script’i-Yazmak" class="headerlink" title="Ayar Dosyalarını Oluşturan Script’i Yazmak"></a>Ayar Dosyalarını Oluşturan Script’i Yazmak</h3><p>Şimdi temel yapılandırma ayarlarımızı sertifika, anahtar ve şifreleme dosyaları ile derlemek için küçük bir script yazacağız. Bu çıktıları da <code>~/client-configs/files</code> klasöründe depolayacağız.</p>
<p><code>~/client-configs</code> klasörünün içine <code>make_config.sh</code> adında bir script oluşturalım.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vi ~/client-configs/make_config.sh</div></pre></td></tr></table></figure></p>
<p>Dosyamızın içine şunları yazalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line"># First argument: Client identifier</div><div class="line"></div><div class="line">KEY_DIR=~/openvpn-ca/keys</div><div class="line">OUTPUT_DIR=~/client-configs/files</div><div class="line">BASE_CONFIG=~/client-configs/base.conf</div><div class="line"></div><div class="line">cat $&#123;BASE_CONFIG&#125; \</div><div class="line">    &lt;(echo -e &apos;&lt;ca&gt;&apos;) \</div><div class="line">    $&#123;KEY_DIR&#125;/ca.crt \</div><div class="line">    &lt;(echo -e &apos;&lt;/ca&gt;\n&lt;cert&gt;&apos;) \</div><div class="line">    $&#123;KEY_DIR&#125;/$&#123;1&#125;.crt \</div><div class="line">    &lt;(echo -e &apos;&lt;/cert&gt;\n&lt;key&gt;&apos;) \</div><div class="line">    $&#123;KEY_DIR&#125;/$&#123;1&#125;.key \</div><div class="line">    &lt;(echo -e &apos;&lt;/key&gt;\n&lt;tls-auth&gt;&apos;) \</div><div class="line">    $&#123;KEY_DIR&#125;/ta.key \</div><div class="line">    &lt;(echo -e &apos;&lt;/tls-auth&gt;&apos;) \</div><div class="line">    &gt; $&#123;OUTPUT_DIR&#125;/$&#123;1&#125;.ovpn</div></pre></td></tr></table></figure></p>
<p>sonrasında kaydedip kapatalım.</p>
<p>Bu dosyayı çalıştırabilmek için izinleri ayarlayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ chmod u+x ~/client-configs/make_config.sh</div></pre></td></tr></table></figure></p>
<h2 id="Istemci-Ayarlarini-Olusturmak"><a href="#Istemci-Ayarlarini-Olusturmak" class="headerlink" title="İstemci Ayarlarını Oluşturmak"></a>İstemci Ayarlarını Oluşturmak</h2><p>Artık istemcilerimiz için ayar dosyalarını kolayca oluşturabiliriz.</p>
<p>Eğer bu anlatımı takip ettiyseniz <a href="https://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/#Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma">İstemci Sertifikası ve Anahtar Çifti Oluşturma</a> adımında <code>./build-key spootrickLaptop</code> komutunu kullanarak <code>spootrickLaptop</code> adında bir istemci sertifikası ve anahtarı oluşturmuştuk. (<code>spootrickLaptop.crt</code> ve <code>spootrickLaptop.key</code>)</p>
<p>Şimdi az önce oluşturduğumuz <code>make_config.sh</code> scripti kullanarak <code>spootrickLaptop</code> için yapılandırma ayarlarını oluşturabiliriz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd ~/client-configs</div><div class="line">$ ./make_config.sh spootrickLaptop</div></pre></td></tr></table></figure></p>
<p>Bu komut <code>~/client-configs/files</code> yoluna <code>spootrickLaptop.ovpn</code> adında bir dosya oluşturacak.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ls -lh ~/client-configs/files</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-rw-rw-r-- 1 spootrick spootrick 13K Feb 21 16:40 spootrickLaptop.ovpn</div></pre></td></tr></table></figure>
<h2 id="Yapilandirma-Dosyalarinin-Transferi"><a href="#Yapilandirma-Dosyalarinin-Transferi" class="headerlink" title="Yapılandırma Dosyalarının Transferi"></a>Yapılandırma Dosyalarının Transferi</h2><p>Az önceki aşamada oluşturmuş olduğumuz <code>.ovpn</code> uzantılı dosyayı hangi cihazda kullanacaksak ona aktarmamız gerekli. Bunun için SCP (secure copy) kullanacağım.</p>
<p>Kendi local bilgisayarımdan (sunucudan değil!) bir terminal açıp şu komutu giriyorum:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ scp -Pxxxx -r KULLANICI_ADI@SUNUCU_IP_ADRESI:client-configs/files/. ~/Desktop</div></pre></td></tr></table></figure></p>
<p>yukarıda -Pxxxx yazan kısmı sunucunuzda SSH portunu değiştirdiyseniz, değiştirdiğiniz portu belirtmeniz için.</p>
<p>Bu komut <code>~/client-configs/files</code> klasöründeki bütün dosyaları local bilgisayarınızdaki masaüstüne kopyalar.</p>
<p>Bu işlemi grafik arabirimi olan <a href="https://filezilla-project.org/" target="_blank" rel="external">FileZilla</a> ile de gerçekleştirebilirsiniz.</p>
<h2 id="Istemci-Yapilandirmasini-Yuklemek"><a href="#Istemci-Yapilandirmasini-Yuklemek" class="headerlink" title="İstemci Yapılandırmasını Yüklemek"></a>İstemci Yapılandırmasını Yüklemek</h2><p>Artık VPN sunucumuzda bütün ayarları tamamladık. Bu aşamada VPN sunucunuzu hangi cihazda kullanmak istiyorsanız onunla ilgili bölüme geçebilirsiniz.</p>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><p>Linux dağıtımınıza bağlı olarak birçok uygulama bulunmakta. Ben Ubuntu’da OpenVPN’in kendi uygulamasını kullanıyorum. Ubuntu veya Debian için şu yolu izleyebilirsiniz:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">local $ sudo apt-get update &amp;&amp; sudo apt-get install openvpn</div></pre></td></tr></table></figure></p>
<p>Bağlanmak için ise, yükleme işleminden sonra local makinamıza çektiğimiz <code>.ovpn</code> uzantılı dosyamızla bağlantımızı oluşturabiliriz.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">local $ sudo openvpn --config ~/Desktop/spootrickLaptop.ovpn</div></pre></td></tr></table></figure></p>
<h3 id="OSX"><a href="#OSX" class="headerlink" title="OSX"></a>OSX</h3><p>Mac OS X için açık kaynak kodlu olan <a href="https://tunnelblick.net/" target="_blank" rel="external">Tunnelblick</a> OpenVPN istemcisini kullanabilirsiniz.</p>
<p>Kurulumun sonuna doğru sizden config dosyasını isteyecektir. Bu aşamada <code>No</code> seçip kurulumu tamamladıktan sonra Finder’dan <code>.ovpn</code> uzantılı dosyamıza çift tıklarsak Tunnelblick istemci profilini kuracaktır. (Yönetici yetkileri gerektirir.)</p>
<p>Bağlanmak için ise, uygulamayı çalıştırdıktan sonra menü çubuğundan ikonuna tıkladıktan sonra <code>Connect</code> menüsünden bağlantı ismini seçip bağlanabilirsiniz. Bağlantı ismi <code>.ovpn</code> uzantılı dosya isminizle aynı olacaktır.</p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><p>Bilgisayarınıza uyumlu olan sürümü <a href="https://openvpn.net/index.php/open-source/downloads.html" target="_blank" rel="external">OpenVPN indirme sayfası</a>ndan indirebilirsiniz.</p>
<p>Programı indirip kurduktan sonra (yönetici izni gerektirir) <code>.ovpn</code> uzantılı dosyayı;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">C:\Program Files\OpenVPN\config</div></pre></td></tr></table></figure></p>
<p>klasörünün içine kopyalayın.</p>
<p>Programı çalıştırdığınızda OpenVPN istemci profilinizi otomatik olarak algılayacaktır. OpenVPN programını her seferinde yönetici izinleri ile çalıştırmanız gerekecektir. Bunu kolay hale getirmek için program ikonuna sağ tıkladıktan sonra<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Özellikler -&gt; Uyumluluk -&gt; Bu programı yönetici olarak çalıştır</div></pre></td></tr></table></figure></p>
<p>kutucuğunu işaretleyin.</p>
<p>Bağlanmak için ise, uygulamayı açtıktan sonra (uygulama sistem tepsisinde -sağ altta- başlayacaktır) ikona sağ tıklayıp <code>.ovpn</code> uzantılı istemci profil isminizi seçip bağlanabilirsiniz.</p>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>Telefonunuza/tabletinize <code>.ovpn</code> uzantılı istemci profil dosyanızı aktarın. Sonra <a href="https://play.google.com/store/apps/details?id=net.openvpn.openvpn" target="_blank" rel="external">OpenVPN Connect</a> uygulamasını Google Play’den indirdin.</p>
<p>Bağlanmak için ise, uygulamayı açın. Sağ üstteki 3 noktaya basın. Ardından import seçeneğini seçin. Açılan ekrandan <code>.ovpn</code> uzantılı dosyanızı bulun ve ana ekranda çıkan <strong>Connect</strong> butonuna tıklayın.</p>
<h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><p>Telefonunuza/tabletinize <a href="https://itunes.apple.com/us/app/id590379981" target="_blank" rel="external">OpenVPN Connect</a> uygulamasını iTunes’dan indirip kurun. <code>.ovpn</code> uzantılı dosyanızı aktarmak için telefonunuzu bilgisayara bağlayın. iTunes’dan <strong>iPhone -&gt; apps</strong> kısmına gelin. <strong>Dosya paylaşımı</strong> bölümünden OpenVPN uygulamasını seçin. Sağ kısımdaki <strong>OpenVPN Dosyaları</strong> kısmına <code>.ovpn</code> uzantılı dosyanızı sürükleyip bırakın.</p>
<p>Telefonunuzdan uygulamayı açtığınızda yeni profilin içe aktarılmaya hazır olduğuna dair bir bildirim alacaksınız. Yeşil <strong>+</strong> butonuna basın.</p>
<p>Bağlanmak için ise, <strong>Connect</strong> butonunu <strong>On</strong> pozisyonuna doğru kaydırın.</p>
<h2 id="VPN-Baglanti-Testi"><a href="#VPN-Baglanti-Testi" class="headerlink" title="VPN Bağlantı Testi"></a>VPN Bağlantı Testi</h2><p>Her şey kurulduktan sonra VPN sunucumuzun düzgün çalıştığını kontrol etmek için bir test yapalım.</p>
<p>VPN bağlantınız <strong>etkin olmadan</strong> bir tarayıcı sayfası açın ve şu adrese gidin: <a href="https://www.dnsleaktest.com/" target="_blank" rel="external">DNSLeakTest</a></p>
<p>Bu site size, servis sağlayıcınız tarafından atanan IP adresinizi gösterecektir. Hangi DNS sunucularını kullandığınızı görmek için <strong>Extended Test</strong> butonuna basın.</p>
<p>Şimdi VPN bağlantınızı <strong>aktifleştirin</strong> ve tekrar <a href="https://www.dnsleaktest.com/" target="_blank" rel="external">DNSLeakTest</a> sayfasını açın. Şu anda size VPN sunucunuzun IP adresini göstermesi gerekiyor. Tekrar <strong>Extended Test</strong> tuşuna basarak kullandığınız DNS sunucularını görebilirsiniz.</p>
<h2 id="Istemci-Sertifikalarini-Iptal-Etmek"><a href="#Istemci-Sertifikalarini-Iptal-Etmek" class="headerlink" title="İstemci Sertifikalarını İptal Etmek"></a>İstemci Sertifikalarını İptal Etmek</h2><p>Bazen, bazı istemcilerin VPN servisine erişimini kesmek isteyebilirsiniz. Bunun için istemci sertifikalarını iptal etmeniz gerekir.</p>
<p>Bunun için CA dizinimize gidip <code>vars</code> dosyamızı re-soruce etmemiz gerekiyor.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ cd ~/openvpn-CA</div><div class="line">$ source vars</div></pre></td></tr></table></figure></p>
<p>Sonrasında <code>revoke-full</code> komutuyla sertifikasını iptal edebilirsiniz:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ./revoke-full spootrickLaptop</div></pre></td></tr></table></figure></p>
<p>Bu işlem <code>error 23</code> kodu ile sonuçlanacaktır. Bu işlemin başarılı bir şekilde gerekli iptal bilgilerini ürettiğini gösterir. Bu bilgiler <code>keys</code> klasöründe <code>crl.pem</code> adlı dosyada toplanır.</p>
<p>Bu dosyayı <code>/etc/openvpn</code> klasörüne kopyalayalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo cp ~/openvpn-CA/keys/crl.pem /etc/openvpn</div></pre></td></tr></table></figure></p>
<p>Sonra OpenVPN sunucu ayar dosyamızı açalım:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vi /etc/openvpn/kebap.conf</div></pre></td></tr></table></figure></p>
<p>Dosyanın en altına <code>crl-verify</code> satırını ekleyelim. Bu işlem OpenVPN sunucumuzun sertifika iptallerini kontrol etmesini sağlar.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">crl-verify crl.pem</div></pre></td></tr></table></figure></p>
<p>Kaydedip kapatın.</p>
<p>Son olarak OpenVPN işlemini yeniden başlatmamız gerekiyor:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl restart openvpn@kebap</div></pre></td></tr></table></figure></p>
<p>Takip ettiğimiz adımları özetleyecek olursak:</p>
<ul>
<li><code>vars</code> dosyasını re-soruce ederek <code>revoke-full</code> komutunu çalıştırmak.</li>
<li>Oluşturulan yeni sertfika iptal listesini <code>/etc/openvpn</code> dizinine kopyalamak ve varsa eski listenin üzerine yazmak.</li>
<li>OpenVPN servisini yeniden başlatmak.</li>
</ul>
<p>Bu işlemler ile önceden oluşturduğunuz bütün sertifikaları iptal edebilirsiniz.</p>
<h2 id="Yeni-Istemci-Ekleme"><a href="#Yeni-Istemci-Ekleme" class="headerlink" title="Yeni İstemci Ekleme"></a>Yeni İstemci Ekleme</h2><p>Daha fazla istemci eklemek için şu adımları takip edebilirsin:</p>
<ul>
<li><a href="https://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/#Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma">İstemci Sertifikası ve Anahtar Çifti Oluşturma</a></li>
<li><a href="https://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/#Istemci-Ayarlarini-Olusturmak">İstemci Ayarlarını Oluşturmak</a></li>
</ul>
<p>adımlarını takip edebilirsin.</p>
<p>Unutma her bir istemci için yeni bir sertifika kullanman lazım. Eğer aynı sertifikayı 2 ayrı cihazda kullanmaya çalışırsan cihazlardan birisi VPN servisine bağlanamayacaktır. Aynı anda bir sertifika ile sadece bir istemci bağlı kalabilir.</p>
<h2 id="Sonuc"><a href="#Sonuc" class="headerlink" title="Sonuç"></a>Sonuç</h2><p>Valla öncelikle seni tebrik ediyorum, bu kadar uzun bir anlatımı bitirdin. Artık ülkemizdeki internet yasaklamalarına takılmayacaksın. Ayrıca internette gezinirken kimliğini, lokasyon bilgilerini ve trafiğini gizli ve güvenli tutacaksın.</p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spootrick">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Nedir-bu-VPN"><span class="toc-number">1.</span> <span class="toc-text">Nedir bu VPN?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Gerekenler"><span class="toc-number">2.</span> <span class="toc-text">Gerekenler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Kurulumu"><span class="toc-number">3.</span> <span class="toc-text">OpenVPN Kurulumu</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CA-Dizini"><span class="toc-number">4.</span> <span class="toc-text">CA Dizini</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CA-Degiskenlerinin-Ayarlanmasi"><span class="toc-number">5.</span> <span class="toc-text">CA Değişkenlerinin Ayarlanması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sertifika-Otoritesini-Olusturmak-CA"><span class="toc-number">6.</span> <span class="toc-text">Sertifika Otoritesini Oluşturmak (CA)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sunucu-Sertifikasi-Anahtar-ve-Sifreleme-Dosyalarini-Olusturmak"><span class="toc-number">7.</span> <span class="toc-text">Sunucu Sertifikası, Anahtar ve Şifreleme Dosyalarını Oluşturmak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Sertifikasi-ve-Anahtar-Cifti-Olusturma"><span class="toc-number">8.</span> <span class="toc-text">İstemci Sertifikası ve Anahtar Çifti Oluşturma</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Hizmetini-Yapilandirma"><span class="toc-number">9.</span> <span class="toc-text">OpenVPN Hizmetini Yapılandırma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dosyalari-OpenVPN-Dizinine-Kopyalama"><span class="toc-number">9.1.</span> <span class="toc-text">Dosyaları OpenVPN Dizinine Kopyalama</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenVPN-Ayarlarinin-Yapilmasi"><span class="toc-number">9.2.</span> <span class="toc-text">OpenVPN Ayarlarının Yapılması</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tum-Trafigin-Yonlendirilmesi"><span class="toc-number">9.3.</span> <span class="toc-text">Tüm Trafiğin Yönlendirilmesi</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sunucu-Ag-Yapilandirmasi"><span class="toc-number">10.</span> <span class="toc-text">Sunucu Ağ Yapılandırması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Firewall-Ayarlarinin-Yapilmasi"><span class="toc-number">11.</span> <span class="toc-text">Firewall Ayarlarının Yapılması</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Port-Ayarlarinin-Yapilmasi"><span class="toc-number">11.1.</span> <span class="toc-text">Port Ayarlarının Yapılması</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenVPN-Servisinin-Baslatilmasi"><span class="toc-number">12.</span> <span class="toc-text">OpenVPN Servisinin Başlatılması</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Yapilandirma-Altyapisi-Olusturma"><span class="toc-number">13.</span> <span class="toc-text">İstemci Yapılandırma Altyapısı Oluşturma</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Temel-Ayarlari-Olusturmak"><span class="toc-number">13.1.</span> <span class="toc-text">Temel Ayarları Oluşturmak</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ayar-Dosyalarini-Olusturan-Script’i-Yazmak"><span class="toc-number">13.2.</span> <span class="toc-text">Ayar Dosyalarını Oluşturan Script’i Yazmak</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Ayarlarini-Olusturmak"><span class="toc-number">14.</span> <span class="toc-text">İstemci Ayarlarını Oluşturmak</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yapilandirma-Dosyalarinin-Transferi"><span class="toc-number">15.</span> <span class="toc-text">Yapılandırma Dosyalarının Transferi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Yapilandirmasini-Yuklemek"><span class="toc-number">16.</span> <span class="toc-text">İstemci Yapılandırmasını Yüklemek</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-number">16.1.</span> <span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OSX"><span class="toc-number">16.2.</span> <span class="toc-text">OSX</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-number">16.3.</span> <span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android"><span class="toc-number">16.4.</span> <span class="toc-text">Android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iOS"><span class="toc-number">16.5.</span> <span class="toc-text">iOS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VPN-Baglanti-Testi"><span class="toc-number">17.</span> <span class="toc-text">VPN Bağlantı Testi</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Istemci-Sertifikalarini-Iptal-Etmek"><span class="toc-number">18.</span> <span class="toc-text">İstemci Sertifikalarını İptal Etmek</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Yeni-Istemci-Ekleme"><span class="toc-number">19.</span> <span class="toc-text">Yeni İstemci Ekleme</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sonuc"><span class="toc-number">20.</span> <span class="toc-text">Sonuç</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&text=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&is_video=false&description=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=OpenVPN Kurulumu (Ubuntu 16.04)&body=Check out this article: http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&title=OpenVPN Kurulumu (Ubuntu 16.04)"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://furkankarakoyunlu.com/ubuntu-openvpn-kurulumu/&name=OpenVPN Kurulumu (Ubuntu 16.04)&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick='$("#toc-footer").toggle();return false;'><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick='$("#share-footer").toggle();return false;'><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick='$("#nav-footer").toggle();return false;'><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2017 Furkan Karakoyunlu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="http://github.com/spootrick">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    <script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-90979308-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'spootrick';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


</body>
</html>
